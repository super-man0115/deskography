<div class="h-full w-full flex justify-center items-center">
  <div class="rounded overflow-hidden border w-full lg:w-6/12 md:w-6/12 bg-white mx-3 md:mx-0 lg:mx-0">
    <div class="w-full flex justify-between p-3">
      <div class="flex">
        <div class="rounded-full h-8 w-8 bg-gray-500 flex items-center justify-center overflow-hidden">
          <%= link_to image_tag(@post.user.decorate.avatar.variant( resize: "100x100^", gravity: "center", crop: "100x100+0+0" )), user_path(@post.user), class: 'rounded-circle avatar-sm' %>
        </div>
        <span class='pt-1 ml-2 font-bold text-sm'><%= link_to @post.user.user_name, user_path(@post.user) %></span>
      </div>
      <div class="relative inline-block text-left" data-controller="dropdown">
        <span class="px-2 hover:bg-gray-300 cursor-pointer rounded" data-action="click->dropdown#toggleMenu">
          <i class="fas fa-ellipsis-h pt-2 text-lg"></i>
        </span>
        <div class="hidden mt-2 origin-top-right absolute right-0 w-56 rounded-md shadow-lg bg-white ring-1 ring-black ring-opacity-5 z-10" data-dropdown-target="menu">
          <div class="py-1" role="menu" aria-orientation="vertical">
            <%= link_to "編集", edit_post_path(@post), class: "block px-4 py-2 text-sm text-gray-700 hover:bg-gray-100" %>
            <%= link_to "削除", post_path(@post), class: "block px-4 py-2 text-sm text-gray-700 hover:bg-gray-100", data: { turbo_method: :delete, turbo_confirm: '削除しますか？' } %>
          </div>
        </div>
      </div>
    </div>
    <div data-controller="image-slider" class="carousel w-full">
      <% @post.images.each.with_index do |image, index| %>
        <div id="slide<%= index + 1 %>" class="carousel-item relative w-full" data-image-slider-target="slide" style="display: <%= index == 0 ? 'block' : 'none' %>">
          <%= image_tag(image.blob.variant(resize_to_fill: [1000, 600])) %>
          <div class="absolute flex justify-between transform -translate-y-1/2 left-5 right-5 top-1/2">
            <%= link_to "❮", "#slide#{(index - 1 + @post.images.size) % @post.images.size + 1}", class: "btn btn-circle left-arrow", data: { action: "image-slider#previousSlide", image_slider_target: "arrow" } %>
            <%= link_to "❯", "#slide#{(index + 1) % @post.images.size + 1}", class: "btn btn-circle right-arrow", data: { action: "image-slider#nextSlide", image_slider_target: "arrow" } %>
          </div>
        </div>
      <% end %>
    </div>
    <div class="px-3 pb-2">
      <div class="pt-2">
        <span class="text text-gray-400 font-medium"><%= @post.age_group_i18n + @post.business_attribute_i18n %></span>
      </div>
      <div>
        <%= render 'posts/bookmark_button', post: @post  %>
      </div>
      <div class="pt-1">
        <% @post.tags.each do |tag| %>
          <%= link_to tag.name, '#', class: 'inline-flex items-center px-3 py-2 text-sm font-medium text-center text-white bg-blue-700 rounded-lg hover:bg-blue-800 focus:ring-4 focus:outline-none focus:ring-blue-300 dark:bg-blue-600 dark:hover:bg-blue-700 dark:focus:ring-blue-800' %>
        <% end %>
        <div class="mb-2 text-sm">
          <div>
            <%= @post.description %>
          </div>
          <% @post.items.each do |item| %>
            <div class="my-10 flex max-w-md overflow-hidden bg-white rounded-lg shadow-lg dark:bg-gray-800">
              <div class="w-1/3 bg-cover"><%= image_tag (item.image) %></div>
              <div class="w-2/3 p-4 md:p-4">
                <h1 class="text-sm font-bold text-gray-800 dark:text-white">
                  <% if item[:name].length > 20 %>
                    <%= link_to truncate(item.name, length: 40, separator: ' '), "#{item.rakuten_url}" %>
                    <button class="text-blue-500 hover:text-blue-800" onclick="document.getElementById('modal-<%= item.item_code %>').classList.add('opacity-100', 'pointer-events-auto');"><i class="fa-solid fa-angles-down"></i></button>
                    <div id="modal-<%= item.item_code %>" class="fixed inset-0 z-10 bg-gray-800 bg-opacity-50 flex items-center justify-center opacity-0 pointer-events-none">
                      <div class="bg-white rounded-lg p-4 max-w-lg mx-auto my-auto">
                        <p><%= item[:name] %></p>
                        <button class="mt-4 text-sm font-medium text-gray-500 hover:text-gray-800" onclick="document.getElementById('modal-<%= item.item_code %>').classList.remove('opacity-100', 'pointer-events-auto');">閉じる</button>
                      </div>
                    </div>
                  <% else %>
                    <%= link_to item.name, "#{item.rakuten_url}" %>
                  <% end %>
                </h1>
                <p class="mt-2 text-xs text-gray-600 dark:text-gray-400">
                  <%= truncate(item.caption, length: 100, separator: ' ') %>
                  <% if item[:caption].length > 100 %>
                    <button class="text-blue-500 hover:text-blue-800" onclick="document.getElementById('modal-caption-<%= item.item_code %>').classList.add('opacity-100', 'pointer-events-auto');">もっと見る</button>
                    <div id="modal-caption-<%= item.item_code %>" class="fixed inset-0 z-10 bg-gray-800 bg-opacity-50 flex items-center justify-center opacity-0 pointer-events-none">
                      <div class="bg-white rounded-lg p-4 max-w-lg mx-auto my-auto">
                        <p><%= item.caption %></p>
                        <button class="mt-4 text-sm font-medium text-gray-500 hover:text-gray-800" onclick="document.getElementById('modal-caption-<%= item.item_code %>').classList.remove('opacity-100', 'pointer-events-auto');">閉じる</button>
                      </div>
                    </div>
                  <% end %>
                </p>
                <div class="flex justify-between mt-3 item-center">
                  <h1 class="text-base font-bold text-gray-700 dark:text-gray-200 md:text-xl"><%= number_to_currency(item.price, unit: '¥', delimiter: ',', format: '%u%n') %></h1>
                  <%= link_to '詳細をみる', "#{item.rakuten_url}", class: "px-2 py-1 text-xs font-bold text-white uppercase transition-colors duration-300 transform bg-gray-800 rounded dark:bg-gray-700 hover:bg-gray-700 dark:hover:bg-gray-600 focus:outline-none focus:bg-gray-700 dark:focus:bg-gray-600" %>
                </div>
              </div>
            </div>
          <% end %>
        </div>
      </div>
      <div class="flex justify-center">
        <%= render 'comments/form', { post: @post, comment: @comment } %>
      </div>
      <br/>
      <br/>
      <div class="flex justify-center">
        <%= render 'comments/comments', { comments: @comments } %>
      </div>
    </div>
  </div>
</div>
